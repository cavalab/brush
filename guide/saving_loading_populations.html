

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Saving and loading populations &mdash; Brush 0.1.dev1+gb15fa8789 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />

  
    <link rel="shortcut icon" href="../_static/paint-brush-solid.svg"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a64c5380"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The archive" href="archive.html" />
    <link rel="prev" title="JSON Interoperability" href="json.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Brush
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Cookbook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data.html">Working with Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="search_space.html">The Search Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="working_with_programs.html">Working with Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="json.html">JSON Interoperability</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Saving and loading populations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#saving-just-the-archive">Saving just the archive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-population-files-with-classification">Using population files with classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialization-with-pickle">Serialization with pickle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-resume-the-fitting-of-an-estimator">Stop/resume the fitting of an estimator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="archive.html">The archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="deap.html">Using Deap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp_api/index.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Brush</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Cookbook</a></li>
      <li class="breadcrumb-item active">Saving and loading populations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/saving_loading_populations.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="saving-and-loading-populations">
<h1>Saving and loading populations<a class="headerlink" href="#saving-and-loading-populations" title="Link to this heading"></a></h1>
<p>Another feature Brush implements is the ability to save and load entire populations.
We use JSON notation to store the population into a file that is human readable. The same way, we can feed an estimator a previous population file to serve as starting point for the evolution.</p>
<p>In this notebook, we will walk through how to use the <code class="docutils literal notranslate"><span class="pre">save_population</span></code> and <code class="docutils literal notranslate"><span class="pre">load_population</span></code> parameters.</p>
<p>We start by getting a sample dataset and splitting it into <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pybrush</span><span class="w"> </span><span class="kn">import</span> <span class="n">BrushRegressor</span>

<span class="c1"># load data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../examples/datasets/d_enc.csv&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To save the population after finishing the evolution, you nee to set <code class="docutils literal notranslate"><span class="pre">save_population</span></code> parameter to a value different than an empty string. Then, the final population is going to be stored in that specific file.</p>
<p>In this example, we create a temporary file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">tempfile</span>

<span class="n">pop_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s1">&#39;population.json&#39;</span><span class="p">)</span>

<span class="c1"># set verbosity==2 to see the full report</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">BrushRegressor</span><span class="p">(</span>
    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SplitBest&#39;</span><span class="p">,</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span><span class="s1">&#39;Mul&#39;</span><span class="p">,</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span><span class="s1">&#39;Cos&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Logabs&#39;</span><span class="p">],</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">],</span>
    <span class="n">scorer</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span>
    <span class="n">save_population</span><span class="o">=</span><span class="n">pop_file</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score:&#39;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generation 1/10 [//////                                            ]
Best model on Val:3.56*Add(If(x0&gt;=0.76,1.18*x4,1.01*x4),4.46*x6)
Train Loss (Med): 13.87972 (61.04575)
Val Loss (Med): 12.52568 (73.18680)
Median Size (Max): 11 (76)
Median complexity (Max): 648 (1485456072)
Time (s): 0.30340

Generation 2/10 [///////////                                       ]
Best model on Val:2.26*Add(1.25*Cos(0.99*x2),1.18*Add(0.35*Mul(0.36*Add(495.40,-2.07*x3),0.33*Cos(1.12*Cos(0.99*Add(6.11*Cos(-1.55*Logabs(1.15*Logabs(1.02*x4))),0.99*Add(1.36*x4,0.99*Mul(0.99*x0,0.99*x3)))))),1.71*Add(If(x0&gt;=0.76,-1.88*x0,2.32*x6),0.66*x4)))
Train Loss (Med): 7.19685 (18.29853)
Val Loss (Med): 9.99819 (19.73273)
Median Size (Max): 12 (90)
Median complexity (Max): 408 (1089403208)
Time (s): 0.46099

Generation 3/10 [////////////////                                  ]
Best model on Val:2.26*Add(1.25*Cos(0.99*x2),1.18*Add(0.35*Mul(0.36*Add(495.40,-2.07*x3),0.33*Cos(1.12*Cos(0.99*Add(6.11*Cos(-1.55*Logabs(1.15*Logabs(1.02*x4))),0.99*Add(1.36*x4,0.99*Mul(0.99*x0,0.99*x3)))))),1.71*Add(If(x0&gt;=0.76,-1.88*x0,2.32*x6),0.66*x4)))
Train Loss (Med): 7.19685 (17.96509)
Val Loss (Med): 9.99819 (19.34284)
Median Size (Max): 9 (76)
Median complexity (Max): 232 (1179617608)
Time (s): 0.61931

Generation 4/10 [/////////////////////                             ]
Best model on Val:0.12*Add(0.51*Add(If(x0&gt;=0.76,If(x0&gt;=0.82,0.49*x1,3.17*x3),23.94*x4),264.10*x6),93.22*x0)
Train Loss (Med): 6.09925 (14.96953)
Val Loss (Med): 7.37980 (18.32659)
Median Size (Max): 18 (82)
Median complexity (Max): 24 (1714917288)
Time (s): 0.81694

Generation 5/10 [//////////////////////////                        ]
Best model on Val:0.22*Add(0.13*Add(If(x0&gt;=0.76,If(x0&gt;=0.82,x1,6.53*x3),49.27*x4),543.56*x6),49.88*x0)
Train Loss (Med): 6.09876 (14.38835)
Val Loss (Med): 7.37979 (16.98444)
Median Size (Max): 19 (82)
Median complexity (Max): 20 (1179617608)
Time (s): 1.10349

Generation 6/10 [///////////////////////////////                   ]
Best model on Val:0.49*Add(0.32*Add(If(x0&gt;=0.76,If(x0&gt;=0.82,0.19*x1,1.21*x3),9.15*x4),100.96*x6),22.36*x0)
Train Loss (Med): 5.84923 (10.96850)
Val Loss (Med): 7.37968 (13.74235)
Median Size (Max): 21 (86)
Median complexity (Max): 20 (2011174224)
Time (s): 1.46493

Generation 7/10 [////////////////////////////////////              ]
Best model on Val:2.12*Add(1.90*Cos(0.99*x2),1.64*Add(0.28*Mul(0.28*Add(506.27,-1.88*x3),0.26*Cos(1.44*Cos(1.00*Add(4.00*Cos(-1.65*Logabs(1.21*Logabs(1.14*x4))),0.99*Add(1.29*x4,0.99*Mul(0.99*x0,0.99*x3)))))),0.71*Add(0.98*Mul(1.95*x0,4.53*x6),1.04*x4)))
Train Loss (Med): 3.15627 (10.75490)
Val Loss (Med): 3.90641 (12.99150)
Median Size (Max): 21 (81)
Median complexity (Max): 20 (2011174224)
Time (s): 1.88341

Generation 8/10 [/////////////////////////////////////////         ]
Best model on Val:2.12*Add(1.90*Cos(0.99*x2),1.64*Add(0.28*Mul(0.28*Add(506.28,-1.88*x3),0.26*Cos(1.44*Cos(1.00*Add(4.00*Cos(-1.65*Logabs(1.21*Logabs(1.14*x4))),0.99*Add(1.29*x4,0.99*Mul(0.99*x0,0.99*x3)))))),0.71*Add(0.98*Mul(1.95*x0,4.53*x6),1.04*x4)))
Train Loss (Med): 3.15626 (7.32961)
Val Loss (Med): 3.90626 (9.54462)
Median Size (Max): 70 (83)
Median complexity (Max): 15 (2011174224)
Time (s): 2.35167

Generation 9/10 [//////////////////////////////////////////////    ]
Best model on Val:2.28*Add(0.37*Cos(0.98*x2),1.79*Add(0.19*Mul(0.19*Add(511.93,-1.67*x3),0.18*Cos(2.98*Cos(1.00*Add(3.54*Cos(-1.62*Logabs(1.20*Logabs(1.12*x4))),1.00*Add(1.30*x4,1.22*Cos(0.99*Mul(0.99*x0,0.99*x3))))))),0.84*Add(0.88*Mul(1.75*x0,4.07*x6),1.31*x4)))
Train Loss (Med): 2.97018 (6.54713)
Val Loss (Med): 3.82776 (8.72991)
Median Size (Max): 72 (86)
Median complexity (Max): 15 (2011174224)
Time (s): 2.92181

Generation 10/10 [//////////////////////////////////////////////////]
Best model on Val:2.23*Add(0.18*Cos(1.01*x2),1.75*Add(0.16*Mul(0.16*Add(69.70*x4,-0.34*x3),0.15*Cos(2.60*Cos(1.01*Add(3.25*Cos(-1.63*Logabs(1.20*Logabs(1.11*x4))),1.00*Add(1.30*x4,1.32*Cos(0.99*Mul(0.99*x0,0.99*x3))))))),0.83*Add(0.86*Mul(1.70*x0,3.94*x6),1.30*x4)))
Train Loss (Med): 2.93713 (6.07609)
Val Loss (Med): 3.55941 (8.50959)
Median Size (Max): 72 (83)
Median complexity (Max): 17 (2011174224)
Time (s): 3.43889

Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmpk_nrpah6/population.json
score: 0.9624956115764942
</pre></div>
</div>
</div>
</div>
<p>Loading a previous population is done providing <code class="docutils literal notranslate"><span class="pre">load_population</span></code> a string value corresponding to a JSON file generated by Brush. In our case, we will use the same file from the previous code block.</p>
<p>After loading the population, we run the evolution for 10 more generations, and we can see that the first generation started from the previous population. This means that the population was successfully saved and loaded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">BrushRegressor</span><span class="p">(</span>
    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SplitBest&#39;</span><span class="p">,</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span><span class="s1">&#39;Mul&#39;</span><span class="p">,</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span><span class="s1">&#39;Cos&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Logabs&#39;</span><span class="p">],</span>
    <span class="n">load_population</span><span class="o">=</span><span class="n">pop_file</span><span class="p">,</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score:&#39;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmpk_nrpah6/population.json of size = 200
Completed 100% [====================]
score: 0.9649080920204649
</pre></div>
</div>
</div>
</div>
<p>There is a convenient way of accessing individuals on the population: just use the index of the individual on the <code class="docutils literal notranslate"><span class="pre">est.population_</span></code> list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># it will contain all individuals, differently than the archive</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;population size:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">population_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;archive size   :&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">archive_</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span> <span class="n">est</span><span class="o">.</span><span class="n">population_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>population size: 100
archive size   : 21
24.17
</pre></div>
</div>
</div>
</div>
<p>you can convert the json representation back to an fully functional individual by wrapping it in the individual class. It is important that the type of individual (i.e. classification, regression) is the same.</p>
<p>Differently from the archive (which is sorted by complexity), the individuals in the population have no specific order. So individual 5 may or may not be more complex than individual 10, for example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind2</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">population_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ind2</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;tree&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>If(x0&gt;=0.76)
|- If(x0&gt;=0.82)
|  |- 33.39*x0
|  |- 37.75
|- Add
|  |- 1.46*Mul
|  |  |- 1.36*x4
|  |  |- 1.59*x6
|  |- 3.86*x4
</pre></div>
</div>
</div>
</div>
<section id="saving-just-the-archive">
<h2>Saving just the archive<a class="headerlink" href="#saving-just-the-archive" title="Link to this heading"></a></h2>
<p>In case you want to use another expression rather than the final <code class="docutils literal notranslate"><span class="pre">best_estimator_</span></code>, brush provides the archive option.</p>
<p>The archive is just the pareto front from the population. You can use <code class="docutils literal notranslate"><span class="pre">predict</span></code> (and <code class="docutils literal notranslate"><span class="pre">predict_proba</span></code> if using a <code class="docutils literal notranslate"><span class="pre">BrushClassifier</span></code>) to call the prediction methods for the entire archive, instead of the selected best individual.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">BrushRegressor</span><span class="p">(</span>
    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SplitBest&#39;</span><span class="p">,</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span><span class="s1">&#39;Mul&#39;</span><span class="p">,</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span><span class="s1">&#39;Cos&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Logabs&#39;</span><span class="p">],</span>
    <span class="n">load_population</span><span class="o">=</span><span class="n">pop_file</span><span class="p">,</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># accessing first expression from the archive. It is serialized as a dict</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">archive_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmpk_nrpah6/population.json of size = 200
Completed 100% [====================]
Fitness(97.702599 2.000000 )
</pre></div>
</div>
</div>
</div>
<p>You can open the serialized file and change individuals’ programs manually.</p>
<p>This also allow us to have checkpoints in the execution.</p>
</section>
<section id="using-population-files-with-classification">
<h2>Using population files with classification<a class="headerlink" href="#using-population-files-with-classification" title="Link to this heading"></a></h2>
<p>To give another example, we do a two-step fit in the cells below.</p>
<p>First, we run the evolution and save the population to a file; then, we load it and keep evolving the individuals.</p>
<p>What is different though is that the first run is optimizing <code class="docutils literal notranslate"><span class="pre">scorer</span></code> and <code class="docutils literal notranslate"><span class="pre">complexity</span></code>, and the second run is optimizing <code class="docutils literal notranslate"><span class="pre">average_precision_score</span></code> and <code class="docutils literal notranslate"><span class="pre">linear_complexity</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pybrush</span><span class="w"> </span><span class="kn">import</span> <span class="n">BrushClassifier</span>

<span class="c1"># load data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../examples/datasets/d_analcatdata_aids.csv&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

<span class="n">pop_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s1">&#39;population.json&#39;</span><span class="p">)</span>

<span class="n">est</span> <span class="o">=</span> <span class="n">BrushClassifier</span><span class="p">(</span>
    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SplitBest&#39;</span><span class="p">,</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span><span class="s1">&#39;Mul&#39;</span><span class="p">,</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span><span class="s1">&#39;Cos&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Logabs&#39;</span><span class="p">],</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">],</span>
    <span class="n">scorer</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">save_population</span><span class="o">=</span><span class="n">pop_file</span><span class="p">,</span>
    <span class="n">pop_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best model:&quot;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score:&#39;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generation 1/10 [//////                                            ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.51436 (0.59792)
Val Loss (Med): 0.60301 (0.69320)
Median Size (Max): 7 (35)
Median complexity (Max): 992 (384239648)
Time (s): 0.16835

Generation 2/10 [///////////                                       ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.51436 (0.59792)
Val Loss (Med): 0.60301 (0.69320)
Median Size (Max): 7 (44)
Median complexity (Max): 992 (28766624)
Time (s): 0.30593

Generation 3/10 [////////////////                                  ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.51436 (0.57623)
Val Loss (Med): 0.60301 (0.70170)
Median Size (Max): 7 (44)
Median complexity (Max): 992 (28766624)
Time (s): 0.44703

Generation 4/10 [/////////////////////                             ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.51436 (0.57595)
Val Loss (Med): 0.60301 (0.70730)
Median Size (Max): 7 (44)
Median complexity (Max): 992 (108051872)
Time (s): 0.57940

Generation 5/10 [//////////////////////////                        ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.50264 (0.57441)
Val Loss (Med): 0.60301 (0.70798)
Median Size (Max): 11 (44)
Median complexity (Max): 992 (180010400)
Time (s): 0.77661

Generation 6/10 [///////////////////////////////                   ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.50264 (0.56985)
Val Loss (Med): 0.60301 (0.70771)
Median Size (Max): 15 (44)
Median complexity (Max): 17312 (243874592)
Time (s): 0.94376

Generation 7/10 [////////////////////////////////////              ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.50264 (0.56147)
Val Loss (Med): 0.60301 (0.70732)
Median Size (Max): 20 (45)
Median complexity (Max): 562592 (1440005536)
Time (s): 1.12788

Generation 8/10 [/////////////////////////////////////////         ]
Best model on Val:Logistic(Sum(0.00,1.00*Sin(1.00*Add(If(AIDS&gt;=16068.00,1.00*Sin(AIDS),AIDS),If(AIDS&gt;=16068.00,1.00,AIDS)))))
Train Loss (Med): 0.50264 (0.55554)
Val Loss (Med): 0.60301 (0.70742)
Median Size (Max): 19 (47)
Median complexity (Max): 562592 (1440005536)
Time (s): 1.31811

Generation 9/10 [//////////////////////////////////////////////    ]
Best model on Val:Logistic(Sum(-0.61,0.40*Exp(-2.02*Sin(2.11*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(1.00*AIDS),-8.35*Sin(1.00*AIDS))),2.11)))))
Train Loss (Med): 0.50264 (0.55520)
Val Loss (Med): 0.57283 (0.70683)
Median Size (Max): 20 (45)
Median complexity (Max): 572192 (1440005536)
Time (s): 1.50146

Generation 10/10 [//////////////////////////////////////////////////]
Best model on Val:Logistic(Sum(-0.61,0.40*Exp(-2.02*Sin(2.11*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(1.00*AIDS),-8.35*Sin(1.00*AIDS))),2.11)))))
Train Loss (Med): 0.50264 (0.54342)
Val Loss (Med): 0.57283 (0.70766)
Median Size (Max): 19 (45)
Median complexity (Max): 562592 (612956576)
Time (s): 1.69596

Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5cb1rhhe/population.json
Best model: Logistic(Sum(-0.61,0.40*Exp(-2.02*Sin(2.11*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(1.00*AIDS),-8.35*Sin(1.00*AIDS))),2.11)))))
score: 0.72
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.72
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">BrushClassifier</span><span class="p">(</span>
    <span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SplitBest&#39;</span><span class="p">,</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span><span class="s1">&#39;Mul&#39;</span><span class="p">,</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span><span class="s1">&#39;Cos&#39;</span><span class="p">,</span><span class="s1">&#39;Exp&#39;</span><span class="p">,</span><span class="s1">&#39;Logabs&#39;</span><span class="p">],</span>
    <span class="n">load_population</span><span class="o">=</span><span class="n">pop_file</span><span class="p">,</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="s2">&quot;linear_complexity&quot;</span><span class="p">],</span>
    <span class="n">scorer</span><span class="o">=</span><span class="s2">&quot;average_precision_score&quot;</span><span class="p">,</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">pop_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="c1"># make sure this is the same as loaded pop</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best model:&quot;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score:&#39;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5cb1rhhe/population.json of size = 400
Generation 1/10 [//////                                            ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.87814 (0.79892)
Val Loss (Med): 0.91111 (0.61905)
Median Size (Max): 14 (58)
Median complexity (Max): 38816 (1297560992)
Time (s): 0.23162

Generation 2/10 [///////////                                       ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88508 (0.79892)
Val Loss (Med): 0.91111 (0.61905)
Median Size (Max): 9 (58)
Median complexity (Max): 1184 (109139360)
Time (s): 0.40799

Generation 3/10 [////////////////                                  ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88640 (0.79892)
Val Loss (Med): 0.91111 (0.56444)
Median Size (Max): 7 (64)
Median complexity (Max): 752 (5625248)
Time (s): 0.55956

Generation 4/10 [/////////////////////                             ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88640 (0.79892)
Val Loss (Med): 0.91111 (0.71429)
Median Size (Max): 7 (56)
Median complexity (Max): 992 (2154560)
Time (s): 0.72180

Generation 5/10 [//////////////////////////                        ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.32949)
Val Loss (Med): 0.91111 (0.46929)
Median Size (Max): 7 (62)
Median complexity (Max): 176 (1389827488)
Time (s): 0.86879

Generation 6/10 [///////////////////////////////                   ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.32949)
Val Loss (Med): 0.91111 (0.46929)
Median Size (Max): 7 (62)
Median complexity (Max): 176 (1389827488)
Time (s): 1.04083

Generation 7/10 [////////////////////////////////////              ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.32949)
Val Loss (Med): 0.91111 (0.46929)
Median Size (Max): 7 (62)
Median complexity (Max): 176 (1389827488)
Time (s): 1.24817

Generation 8/10 [/////////////////////////////////////////         ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.56420)
Val Loss (Med): 0.91111 (0.46929)
Median Size (Max): 7 (62)
Median complexity (Max): 176 (1389827488)
Time (s): 1.42332

Generation 9/10 [//////////////////////////////////////////////    ]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.79892)
Val Loss (Med): 0.91111 (0.60067)
Median Size (Max): 7 (62)
Median complexity (Max): 992 (1389827488)
Time (s): 1.61006

Generation 10/10 [//////////////////////////////////////////////////]
Best model on Val:Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
Train Loss (Med): 0.88944 (0.79892)
Val Loss (Med): 0.91111 (0.59262)
Median Size (Max): 7 (62)
Median complexity (Max): 992 (1389827488)
Time (s): 1.80558

Best model: Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
score: 0.68
</pre></div>
</div>
</div>
</div>
<p>We can see the fitness object, and that the scorer now matches the average precision score metric:</p>
<blockquote>
<div><p>Some differences may be due to part of the data being used as an inner validation partition</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitness is (scorer, linear complexity)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitness(0.911111 105.000000 )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">average_precision_score</span>

<span class="c1"># takes y_true as first argument, and y_pred as second argument.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AUPRC:&quot;</span><span class="p">,</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model size:&quot;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model:&quot;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">program</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUPRC: 0.8318032741101248
Model size: 29
Model: Logistic(Sum(0.00,-0.79*Sin(2.12*Mul(0.83*Sin(-8.35*Mul(-8.39*Logabs(0.99*AIDS),-8.35*Sin(1.00*AIDS))),2.11))))
</pre></div>
</div>
</div>
</div>
</section>
<section id="serialization-with-pickle">
<h2>Serialization with pickle<a class="headerlink" href="#serialization-with-pickle" title="Link to this heading"></a></h2>
<p>You can save the entire model (best individual, parameters, and archive) with pickle.</p>
<blockquote>
<div><p>At the current stage, Brush does not serialize the search space and dataset references, but only the necessary information to be able to load a previously trained model and do predictions with it.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><body><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>BrushClassifier(algorithm=&#x27;nsga2&#x27;, bandit=&#x27;dynamic_thompson&#x27;, batch_size=1.0,
                class_weights=&#x27;support&#x27;, constants_simplification=True,
                cx_prob=0.14285714285714285, final_model_selection=&#x27;&#x27;,
                functions=[&#x27;SplitBest&#x27;, &#x27;Add&#x27;, &#x27;Mul&#x27;, &#x27;Sin&#x27;, &#x27;Cos&#x27;, &#x27;Exp&#x27;,
                           &#x27;Logabs&#x27;],
                inexact_simplification=True, initialization=&#x27;uniform&#x27;,
                load_population=&#x27;/var/folders/mh/ggnb_jv93cl_gbqbg2j...
                                &#x27;insert&#x27;: 0.16666666666666666,
                                &#x27;point&#x27;: 0.16666666666666666,
                                &#x27;subtree&#x27;: 0.16666666666666666,
                                &#x27;toggle_weight_off&#x27;: 0.16666666666666666,
                                &#x27;toggle_weight_on&#x27;: 0.16666666666666666},
                n_jobs=1, num_islands=5,
                objectives=[&#x27;scorer&#x27;, &#x27;linear_complexity&#x27;], pop_size=200,
                random_state=None, save_population=&#x27;&#x27;,
                scorer=&#x27;average_precision_score&#x27;, sel=&#x27;lexicase&#x27;,
                shuffle_split=False, surv=&#x27;nsga2&#x27;, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>BrushClassifier</div></div><div><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                <table class="parameters-table">
                  <tbody>
                    
        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('pop_size',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">pop_size&nbsp;</td>
            <td class="value">200</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('max_gens',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">max_gens&nbsp;</td>
            <td class="value">10</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('max_stall',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">max_stall&nbsp;</td>
            <td class="value">0</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('max_time',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">max_time&nbsp;</td>
            <td class="value">-1</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('verbosity',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">verbosity&nbsp;</td>
            <td class="value">2</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('algorithm',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">algorithm&nbsp;</td>
            <td class="value">&#x27;nsga2&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('mode',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">mode&nbsp;</td>
            <td class="value">&#x27;classification&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('max_depth',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">max_depth&nbsp;</td>
            <td class="value">10</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('max_size',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">max_size&nbsp;</td>
            <td class="value">100</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('num_islands',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">num_islands&nbsp;</td>
            <td class="value">5</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('mig_prob',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">mig_prob&nbsp;</td>
            <td class="value">0.05</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('n_jobs',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">n_jobs&nbsp;</td>
            <td class="value">1</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('cx_prob',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">cx_prob&nbsp;</td>
            <td class="value">0.14285714285714285</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('bandit',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">bandit&nbsp;</td>
            <td class="value">&#x27;dynamic_thompson&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('logfile',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">logfile&nbsp;</td>
            <td class="value">&#x27;&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('final_model_selection',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">final_model_selection&nbsp;</td>
            <td class="value">&#x27;&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('save_population',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">save_population&nbsp;</td>
            <td class="value">&#x27;&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('load_population',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">load_population&nbsp;</td>
            <td class="value">&#x27;/var/folders/mh/ggnb_j...cb1rhhe/population.json&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('mutation_probs',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">mutation_probs&nbsp;</td>
            <td class="value">{&#x27;delete&#x27;: 0.16666666666666666, &#x27;insert&#x27;: 0.16666666666666666, &#x27;point&#x27;: 0.16666666666666666, &#x27;subtree&#x27;: 0.16666666666666666, ...}</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('functions',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">functions&nbsp;</td>
            <td class="value">[&#x27;SplitBest&#x27;, &#x27;Add&#x27;, ...]</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('objectives',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">objectives&nbsp;</td>
            <td class="value">[&#x27;scorer&#x27;, &#x27;linear_complexity&#x27;]</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('constants_simplification',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">constants_simplification&nbsp;</td>
            <td class="value">True</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('inexact_simplification',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">inexact_simplification&nbsp;</td>
            <td class="value">True</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('scorer',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">scorer&nbsp;</td>
            <td class="value">&#x27;average_precision_score&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('shuffle_split',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">shuffle_split&nbsp;</td>
            <td class="value">False</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('initialization',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">initialization&nbsp;</td>
            <td class="value">&#x27;uniform&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('random_state',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">random_state&nbsp;</td>
            <td class="value">None</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('batch_size',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">batch_size&nbsp;</td>
            <td class="value">1.0</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('sel',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">sel&nbsp;</td>
            <td class="value">&#x27;lexicase&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('surv',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">surv&nbsp;</td>
            <td class="value">&#x27;nsga2&#x27;</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('weights_init',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">weights_init&nbsp;</td>
            <td class="value">True</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('validation_size',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">validation_size&nbsp;</td>
            <td class="value">0.2</td>
        </tr>
    

        <tr class="user-set">
            <td><i class="copy-paste-icon"
                 onclick="copyToClipboard('class_weights',
                          this.parentElement.nextElementSibling)"
            ></i></td>
            <td class="param">class_weights&nbsp;</td>
            <td class="value">&#x27;support&#x27;</td>
        </tr>
    
                  </tbody>
                </table>
            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script></body></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="n">est_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s1">&#39;est.pkl&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">est_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_est</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">est_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loaded_est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ True False False  True False  True False  True  True  True  True  True
  True  True  True  True  True False  True  True  True  True False  True
  True  True  True False  True False  True False False  True False False
 False  True  True False False False False  True False  True False False
  True False]
[ True False False  True False  True False  True  True  True  True  True
  True  True  True  True  True False  True  True  True  True False  True
  True  True  True False  True False  True False False  True False False
 False  True  True False False False False  True False  True False False
  True False]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loaded_est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ True False False  True False  True False  True  True  True  True  True
  True  True  True  True  True False  True  True  True  True False  True
  True  True  True False  True False  True False False  True False False
 False  True  True False False False False  True False  True False False
  True False]
[ True False False  True False  True False  True  True  True  True  True
  True  True  True  True  True False  True  True  True  True False  True
  True  True  True False  True False  True False False  True False False
 False  True  True False False False False  True False  True False False
  True False]
</pre></div>
</div>
</div>
</div>
</section>
<section id="stop-resume-the-fitting-of-an-estimator">
<h2>Stop/resume the fitting of an estimator<a class="headerlink" href="#stop-resume-the-fitting-of-an-estimator" title="Link to this heading"></a></h2>
<p>In the code below I try to mimic how pytorch models are trained: we can stop the training at any time, and we can resume it later.</p>
<p>The idea is to demonstrate how to use population files to store checkpoints, and continuing from the last saved checkpoint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(),</span> <span class="s1">&#39;brush_pop_checkpoint.json&#39;</span><span class="p">)</span>
    
    <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">max_gens</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">max_gens</span>
    <span class="n">est</span><span class="o">.</span><span class="n">max_gens</span> <span class="o">=</span> <span class="n">step</span>
    <span class="n">est</span><span class="o">.</span><span class="n">save_population</span> <span class="o">=</span> <span class="n">checkpoint</span>
    <span class="n">est</span><span class="o">.</span><span class="n">load_population</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    
    <span class="c1"># You can set validation_size to a value greater than zero</span>
    <span class="c1"># and shuffle_split to true to have random bathes of data</span>
    <span class="n">est</span><span class="o">.</span><span class="n">shuffle_split</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">est</span><span class="o">.</span><span class="n">validation_size</span> <span class="o">=</span> <span class="mf">0.2</span>
    
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_gens</span> <span class="o">//</span> <span class="n">step</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Progress </span><span class="si">{</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_gens</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># Notice that this will reset the MAB everytime!</span>

        <span class="c1"># Enable loading the checkpoint after a first run</span>
        <span class="n">est</span><span class="o">.</span><span class="n">load_population</span> <span class="o">=</span> <span class="n">checkpoint</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best model:&quot;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score     :&#39;</span><span class="p">,</span> <span class="n">est</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="c1"># Restoring initial state</span>
    <span class="n">est</span><span class="o">.</span><span class="n">max_gens</span> <span class="o">=</span> <span class="n">max_gens</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">BrushClassifier</span><span class="p">(</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scorer&quot;</span><span class="p">,</span> <span class="s2">&quot;linear_complexity&quot;</span><span class="p">],</span>
    <span class="n">scorer</span><span class="o">=</span><span class="s2">&quot;balanced_accuracy&quot;</span><span class="p">,</span>
    <span class="n">max_gens</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">validation_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">pop_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">train</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Progress 1/10
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.30,0.00*AIDS))
score     : 0.68
Progress 2/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.24,0.00*AIDS))
score     : 0.68
Progress 3/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.65,0.65))
score     : 0.5
Progress 4/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.26,0.00*AIDS))
score     : 0.68
Progress 5/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-28.50,If(AIDS&gt;=16068.00,AIDS,1.00)))
score     : 0.68
Progress 6/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.25,0.00*AIDS))
score     : 0.68
Progress 7/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.32,0.00*AIDS))
score     : 0.68
Progress 8/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-28.50,If(AIDS&gt;=16068.00,AIDS,1.00)))
score     : 0.68
Progress 9/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.19,0.00*AIDS))
score     : 0.66
Progress 10/10
Loaded population from /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json of size = 200
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Best model: Logistic(Sum(-0.20,0.00*AIDS))
score     : 0.66
</pre></div>
</div>
</div>
</div>
<p>By default, sklearn estimators will reset when calling fit twice. To continue from last fit, you can call <code class="docutils literal notranslate"><span class="pre">partial_fit</span></code> and brush will resume the training.</p>
<p>If you want, you can change parameters from the <code class="docutils literal notranslate"><span class="pre">est</span></code> object before calling partial fit to update the execution settings.</p>
<p>It is important that the data has the same features (same name and dtype) as the data used in the previous <code class="docutils literal notranslate"><span class="pre">fit</span></code>/<code class="docutils literal notranslate"><span class="pre">partial_fit</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logistic(Sum(-0.20,0.00*AIDS))
Fitness(1.000000 22.000000 )
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Logistic(Sum(-0.27,0.00*AIDS))
Fitness(0.700000 22.000000 )
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">partial_fit</span></code> also allows you to fix an initial portion of the tree before doing the new fit.</p>
<p>You can also choose to leave leaves out of this locking mechanism, this way the terminals close to the root are unlocked and can change.</p>
<p>If you set a big depth and also force leaves to be locked, there may be some (smaller) programs in the population that will not change at all during the run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>

<span class="n">est</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lock_nodes_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">keep_leaves_unlocked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logistic(Sum(-0.27,0.00*AIDS))
Fitness(0.700000 22.000000 )
Completed 100% [====================]
Saved population to file /var/folders/mh/ggnb_jv93cl_gbqbg2jxq0yr0000gn/T/tmp5fzgqu_7/brush_pop_checkpoint.json
Logistic(Sum(-0.24,0.00*AIDS))
Fitness(0.700000 22.000000 )
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="json.html" class="btn btn-neutral float-left" title="JSON Interoperability" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="archive.html" class="btn btn-neutral float-right" title="The archive" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, William La Cava and Joseph D. Romano.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>